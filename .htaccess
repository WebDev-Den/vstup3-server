# ===========================================================
# PHP API - Єдина точка входу
# Всі запити → index.php (крім реальних файлів)
# ===========================================================

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Базова директорія
    RewriteBase /api
    
    # ========================================================
    # ВИКЛЮЧЕННЯ: Дозволити реальні файли та директорії
    # ========================================================
    
    # Якщо це реальний файл - дозволити доступ
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]
    
    # Якщо це реальна директорія - дозволити доступ
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # ========================================================
    # МАРШРУТИЗАЦІЯ: Все інше → index.php
    # ========================================================
    
    # Приклади що спрацюють:
    # /api/ → index.php
    # /api/asdasdas → index.php
    # /api/v0/user/login → index.php
    # /api/anything/else/here → index.php
    
    RewriteRule ^(.*)$ index.php [QSA,L]
    
</IfModule>

# ===========================================================
# ЗАХИСТ ФАЙЛІВ
# ===========================================================

# Заборонити доступ до конфігураційних файлів
RedirectMatch 403 /\.env$
RedirectMatch 403 /config\.php$
RedirectMatch 403 /\.htaccess$
RedirectMatch 403 /\.htpasswd$

# Заборонити приховані файли Unix
RedirectMatch 403 /\.[^/]+$

# Заборонити небезпечні розширення
RedirectMatch 403 \.(ini|log|sql|bak|backup|conf|dist|sh|bat)$

# ===========================================================
# ОПЦІЇ
# ===========================================================

# Заборонити листинг директорій
Options -Indexes

# Дозволити FollowSymLinks (потрібно для RewriteRule)
Options +FollowSymLinks
