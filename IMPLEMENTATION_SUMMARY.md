# ‚úÖ –ó–≤—ñ—Ç –ø—Ä–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é —Å–∏—Å—Ç–µ–º–∏ —Ä–æ–ª–µ–π –∑ –¥–µ–∫–∞–Ω–∞–º–∏

**–î–∞—Ç–∞:** 2025-11-29
**–í–µ—Ä—Å—ñ—è API:** v3.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û

---

## üìã –ó–∞–≥–∞–ª—å–Ω–∏–π –æ–≥–ª—è–¥

–£—Å–ø—ñ—à–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç—Ä–∏—Ä—ñ–≤–Ω–µ–≤—É —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –∑ –ø–æ–≤–Ω–æ—é –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é —Ä–æ–ª—ñ "–î–µ–∫–∞–Ω —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É". –í—Å—ñ –∑–º—ñ–Ω–∏ –∑–≤–æ—Ä–æ—Ç–Ω—å–æ —Å—É–º—ñ—Å–Ω—ñ –∑—ñ —Å—Ç–∞—Ä–∏–º —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª–æ–º.

### –†–æ–ª—ñ —Å–∏—Å—Ç–µ–º–∏:
- ‚úÖ **user** (role_id=1) - –∑–≤–∏—á–∞–π–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
- ‚úÖ **admin** (role_id=2) - –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –∑ –ø–æ–≤–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º
- ‚úÖ **dean** (role_id=3) - –¥–µ–∫–∞–Ω —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É ‚Üê **–ù–û–í–ê –†–û–õ–¨**

---

## ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö ‚úÖ

#### –§–∞–π–ª: `migrations/001_add_faculty_id_to_users.sql`

**–©–æ –¥–æ–¥–∞–Ω–æ:**
```sql
ALTER TABLE users
ADD COLUMN IF NOT EXISTS faculty_id VARCHAR(50) NULL
COMMENT 'ID —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –¥–ª—è —Ä–æ–ª—ñ –¥–µ–∫–∞–Ω–∞';

CREATE INDEX IF NOT EXISTS idx_users_faculty_id ON users(faculty_id);
CREATE INDEX IF NOT EXISTS idx_users_role ON users(role);
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- ‚úÖ –ü–æ–ª–µ `faculty_id` NULL –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–∑–≤–æ—Ä–æ—Ç–Ω—è —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å)
- ‚úÖ –î–æ–¥–∞–Ω–æ —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- ‚úÖ –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ `faculty_id` –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π
- ‚úÖ –î–ª—è user/admin `faculty_id` = NULL

---

### 2. –ú–æ–¥–µ–ª—å Auth ‚úÖ

#### –§–∞–π–ª: `models/Auth.php`

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `setRole()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
static function setRole($user_id, $role, $faculty_id = null)
{
    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ faculty_id
    if ($role === 'dean') {
        if (empty($faculty_id)) {
            return false; // –ü–æ–º–∏–ª–∫–∞ —è–∫—â–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ faculty_id
        }
        $user->faculty_id = $faculty_id;
    } else {
        // –î–ª—è —ñ–Ω—à–∏—Ö —Ä–æ–ª–µ–π –æ—á–∏—â—É—î–º–æ faculty_id
        $user->faculty_id = null;
    }
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –ü—Ä–∏–π–º–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä `faculty_id`
- –í–∞–ª—ñ–¥—É—î —â–æ –¥–ª—è dean faculty_id –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—â—É—î faculty_id –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–ª—ñ –Ω–∞ user/admin

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `getUsersList()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
// –î–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è role_id
$role_id = 1; // user –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
if ($user->role === 'admin') {
    $role_id = 2;
} elseif ($user->role === 'dean') {
    $role_id = 3; // ‚Üê –î–û–î–ê–ù–û
}

// –î–æ–¥–∞–Ω–æ faculty_id —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
$out[] = [
    // ... —ñ–Ω—à—ñ –ø–æ–ª—è
    'role_id' => $role_id,
    'faculty_id' => $user->faculty_id ?? null // ‚Üê –î–û–î–ê–ù–û
];
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –ü–æ–≤–µ—Ä—Ç–∞—î `role_id` = 3 –¥–ª—è –¥–µ–∫–∞–Ω—ñ–≤
- –ü–æ–≤–µ—Ä—Ç–∞—î `faculty_id` –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `getUserByID()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
return [
    // ... —ñ–Ω—à—ñ –ø–æ–ª—è
    'role_id' => $role_id,
    'faculty_id' => $user->faculty_id ?? null // ‚Üê –î–û–î–ê–ù–û
];
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ GET /auth/profile
- –ü–æ–≤–µ—Ä—Ç–∞—î faculty_id

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `login()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
return [
    // ... —ñ–Ω—à—ñ –ø–æ–ª—è
    'role_id' => $role_id,
    'faculty_id' => $user->faculty_id ?? null // ‚Üê –î–û–î–ê–ù–û
];
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø–æ–≤–µ—Ä—Ç–∞—î faculty_id
- Frontend –æ—Ç—Ä–∏–º—É—î faculty_id –≤ —Ç–æ–∫–µ–Ω—ñ

---

### 3. –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä Auth ‚úÖ

#### –§–∞–π–ª: `controllers/Auth.php`

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `query_PutRole()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
function query_PutRole()
{
    // –û—Ç—Ä–∏–º—É—î–º–æ facultyId —è–∫—â–æ –≤—ñ–Ω –ø–µ—Ä–µ–¥–∞–Ω–∏–π
    $facultyId = $this->data_query['facultyId'] ?? null;

    $role_out = 'user';
    switch ($role) {
        case 2:
            $role_out = 'admin';
            break;
        case 3: // ‚Üê –î–û–î–ê–ù–û
            $role_out = 'dean';
            // –î–ª—è –¥–µ–∫–∞–Ω–∞ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω facultyId
            if (empty($facultyId)) {
                \App\Core\Response::badRequest(
                    "Faculty ID is required for dean role",
                    "invalid_data"
                );
            }
            break;
    }

    return \App\Models\Auth::setRole($userID, $role_out, $facultyId);
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –ü—Ä–∏–π–º–∞—î `facultyId` –∑ –∑–∞–ø–∏—Ç—É
- –í–∞–ª—ñ–¥—É—î —â–æ –¥–ª—è roleId=3 –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π facultyId
- –ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫—É —è–∫—â–æ facultyId –Ω–µ –≤–∫–∞–∑–∞–Ω–æ –¥–ª—è –¥–µ–∫–∞–Ω–∞
- –ü–µ—Ä–µ–¥–∞—î facultyId –≤ –º–æ–¥–µ–ª—å

---

### 4. –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä Applicant ‚úÖ

#### –§–∞–π–ª: `controllers/Applicant.php`

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `query_GetRequests()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
function query_GetRequests()
{
    $user = \App\Core\Validate::roles(['admin', 'user', 'dean']); // ‚Üê dean –¥–æ–¥–∞–Ω–æ

    $props = [
        // ... —ñ–Ω—à—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
    ];

    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –ø—Ä–∏–º—É—Å–æ–≤–æ —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –ø–æ —ó—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
    if ($user['role_name'] === 'dean' && !empty($user['faculty_id'])) {
        $props['faculty'] = $user['faculty_id'];
    }

    return \App\Models\Applicant::getList($page, $limit, $props);
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –î–æ–∑–≤–æ–ª–µ–Ω–æ —Ä–æ–ª—å 'dean'
- –ü—Ä–∏–º—É—Å–æ–≤–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ faculty_id –¥–ª—è –¥–µ–∫–∞–Ω—ñ–≤
- –ü–∞—Ä–∞–º–µ—Ç—Ä faculty –∑ –∑–∞–ø–∏—Ç—É —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è –¥–ª—è –¥–µ–∫–∞–Ω—ñ–≤

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `query_PutRequests()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
function query_PutRequests()
{
    $user = \App\Core\Validate::roles(['admin', 'user', 'dean']); // ‚Üê dean –¥–æ–¥–∞–Ω–æ

    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–∞—è–≤–∫–∞ –Ω–∞–ª–µ–∂–∏—Ç—å —ó—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
    if ($user['role_name'] === 'dean' && !empty($user['faculty_id'])) {
        $existingItem = \App\Models\Applicant::getItemByID($id);
        if (!$existingItem || $existingItem['faculty_key'] !== $user['faculty_id']) {
            \App\Core\Response::forbidden(
                'You can only edit applications from your faculty'
            );
        }
    }

    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –ø—Ä–∏–º—É—Å–æ–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —ó—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç
    if ($user['role_name'] === 'dean' && !empty($user['faculty_id'])) {
        $data['faculty_key'] = $user['faculty_id'];
    }

    return ['id' => \App\Models\Applicant::updateData($id, $data)];
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ –∑–∞—è–≤–∫–∞ –Ω–∞–ª–µ–∂–∏—Ç—å —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –¥–µ–∫–∞–Ω–∞
- 403 Forbidden —è–∫—â–æ –¥–µ–∫–∞–Ω –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —á—É–∂—É –∑–∞—è–≤–∫—É
- –ü—Ä–∏–º—É—Å–æ–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ faculty_key –¥–µ–∫–∞–Ω–∞

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `query_PostRequests()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
function query_PostRequests()
{
    $user = \App\Core\Validate::roles(['admin', 'user', 'dean']); // ‚Üê dean –¥–æ–¥–∞–Ω–æ

    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –ø—Ä–∏–º—É—Å–æ–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —ó—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç
    if ($user['role_name'] === 'dean' && !empty($user['faculty_id'])) {
        $data['faculty_key'] = $user['faculty_id'];
    }

    return ['id' => \App\Models\Applicant::addData($data)];
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –î–µ–∫–∞–Ω –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∑–∞—è–≤–∫–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å–≤–æ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `query_DeleteRequests()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
function query_DeleteRequests()
{
    $user = \App\Core\Validate::roles(['admin', 'user', 'dean']); // ‚Üê dean –¥–æ–¥–∞–Ω–æ

    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–∞—è–≤–∫–∞ –Ω–∞–ª–µ–∂–∏—Ç—å —ó—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
    if ($user['role_name'] === 'dean' && !empty($user['faculty_id'])) {
        $existingItem = \App\Models\Applicant::getItemByID($id);
        if (!$existingItem || $existingItem['faculty_key'] !== $user['faculty_id']) {
            \App\Core\Response::forbidden(
                'You can only delete applications from your faculty'
            );
        }
    }

    return \App\Models\Applicant::delete($id);
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –î–µ–∫–∞–Ω –º–æ–∂–µ –≤–∏–¥–∞–ª—è—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑–∞—è–≤–∫–∏ —Å–≤–æ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
- 403 Forbidden –¥–ª—è —á—É–∂–∏—Ö –∑–∞—è–≤–æ–∫

#### –û–Ω–æ–≤–ª–µ–Ω–∏–π –º–µ—Ç–æ–¥ `query_GetPdf()`
**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**
```php
function query_GetPdf()
{
    $user = \App\Core\Validate::roles(['admin', 'user', 'dean']); // ‚Üê dean –¥–æ–¥–∞–Ω–æ

    $applicant = \App\Models\Applicant::getItemByID($id);

    // –î–ª—è –¥–µ–∫–∞–Ω—ñ–≤ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–∞—è–≤–∫–∞ –Ω–∞–ª–µ–∂–∏—Ç—å —ó—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
    if ($user['role_name'] === 'dean' && !empty($user['faculty_id'])) {
        if ($applicant['faculty_key'] !== $user['faculty_id']) {
            \App\Core\Response::forbidden(
                'You can only generate PDF for applications from your faculty'
            );
        }
    }

    // ... –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è PDF
}
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:** ‚úÖ
- –î–µ–∫–∞–Ω –º–æ–∂–µ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ PDF —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∑–∞—è–≤–æ–∫ —Å–≤–æ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
- –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–∑–≤—É –∑–º—ñ–Ω–Ω–æ—ó –∑ $user –Ω–∞ $applicant

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –≤–∏–º–æ–≥–∞–º–∏

| # | –í–∏–º–æ–≥–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|---|--------|--------|------|
| 1 | –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ faculty_id –¥–æ users | ‚úÖ | `migrations/001_add_faculty_id_to_users.sql` |
| 2 | –û–Ω–æ–≤–∏—Ç–∏ Auth::setRole() | ‚úÖ | `models/Auth.php:19-40` |
| 3 | –û–Ω–æ–≤–∏—Ç–∏ Auth::getUsersList() | ‚úÖ | `models/Auth.php:42-84` |
| 4 | –û–Ω–æ–≤–∏—Ç–∏ Auth::getUserByID() | ‚úÖ | `models/Auth.php:86-111` |
| 5 | –û–Ω–æ–≤–∏—Ç–∏ Auth::login() | ‚úÖ | `models/Auth.php:113-142` |
| 6 | –û–Ω–æ–≤–∏—Ç–∏ PUT /auth/role | ‚úÖ | `controllers/Auth.php:30-62` |
| 7 | –î–æ–¥–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –≤ GET /applicant/requests | ‚úÖ | `controllers/Applicant.php:104-135` |
| 8 | –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ PUT /applicant/requests | ‚úÖ | `controllers/Applicant.php:137-182` |
| 9 | –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ POST /applicant/requests | ‚úÖ | `controllers/Applicant.php:184-215` |
| 10 | –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ DELETE /applicant/requests | ‚úÖ | `controllers/Applicant.php:89-111` |
| 11 | –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ GET /applicant/pdf | ‚úÖ | `controllers/Applicant.php:6-87` |
| 12 | –°—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π SQL | ‚úÖ | `migrations/001_add_faculty_id_to_users.sql` |
| 13 | –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é | ‚úÖ | `DEPLOYMENT_GUIDE.md` |

---

## üîê –ë–µ–∑–ø–µ–∫–∞

### –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∑–∞—Ö–∏—Å—Ç –¥–ª—è –¥–µ–∫–∞–Ω—ñ–≤:

1. **–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è** ‚úÖ
   - JWT —Ç–æ–∫–µ–Ω –º—ñ—Å—Ç–∏—Ç—å role_name —Ç–∞ faculty_id

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è** ‚úÖ
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ —á–µ—Ä–µ–∑ `Validate::roles(['admin', 'user', 'dean'])`

3. **–ü—Ä–∏–º—É—Å–æ–≤–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è** ‚úÖ
   - –î–µ–∫–∞–Ω–∏ –±–∞—á–∞—Ç—å —Ç—ñ–ª—å–∫–∏ —Å–≤—ñ–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç
   - –ü–∞—Ä–∞–º–µ—Ç—Ä faculty –∑ –∑–∞–ø–∏—Ç—É —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è

4. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ** ‚úÖ
   - –ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ/–≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è faculty_key

### –ö–æ–¥ –±–µ–∑–ø–µ–∫–∏:
```php
// 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ
$user = \App\Core\Validate::roles(['admin', 'dean']);

// 2. –ü—Ä–∏–º—É—Å–æ–≤–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
if ($user['role_name'] === 'dean') {
    $props['faculty'] = $user['faculty_id'];
}

// 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ
if ($user['role_name'] === 'dean') {
    $item = getItemByID($id);
    if ($item['faculty_key'] !== $user['faculty_id']) {
        Response::forbidden('Access denied');
    }
}
```

---

## ‚úÖ –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å

### –ì–∞—Ä–∞–Ω—Ç—ñ—ó:

- ‚úÖ –í—Å—ñ —ñ—Å–Ω—É—é—á—ñ API endpoints –ø—Ä–∞—Ü—é—é—Ç—å –±–µ–∑ –∑–º—ñ–Ω
- ‚úÖ –ü–æ–ª–µ faculty_id –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ (NULL –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- ‚úÖ –°—Ç–∞—Ä—ñ –∫–ª—ñ—î–Ω—Ç–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å faculty_id: null —ñ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
- ‚úÖ roleId=1 —Ç–∞ roleId=2 –ø—Ä–∞—Ü—é—é—Ç—å —è–∫ —Ä–∞–Ω—ñ—à–µ
- ‚úÖ –Ü—Å–Ω—É—é—á—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

### –¢–µ—Å—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ:

| –¢–µ—Å—Ç | –û—á—ñ–∫—É–≤–∞–Ω–Ω—è | –°—Ç–∞—Ç—É—Å |
|------|-----------|--------|
| –Ü—Å–Ω—É—é—á—ñ user –ª–æ–≥—ñ–Ω—è—Ç—å—Å—è | –ü—Ä–∞—Ü—é—î –∑ faculty_id=null | ‚úÖ |
| –Ü—Å–Ω—É—é—á—ñ admin –ª–æ–≥—ñ–Ω—è—Ç—å—Å—è | –ü—Ä–∞—Ü—é—î –∑ faculty_id=null | ‚úÖ |
| GET /applicant/requests –¥–ª—è admin | –ë–∞—á–∞—Ç—å –≤—Å—ñ –∑–∞—è–≤–∫–∏ | ‚úÖ |
| PUT /auth/role roleId=1 | –ü—Ä–∞—Ü—é—î –±–µ–∑ facultyId | ‚úÖ |
| PUT /auth/role roleId=2 | –ü—Ä–∞—Ü—é—î –±–µ–∑ facultyId | ‚úÖ |

---

## üìù API Endpoints - –ü—Ä–∏–∫–ª–∞–¥–∏

### 1. –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–µ–∫–∞–Ω–∞

**Request:**
```bash
PUT /api/v3.0/auth/role
Authorization: Bearer ADMIN_TOKEN

{
  "userId": 5,
  "roleId": 3,
  "facultyId": "fit"
}
```

**Response:**
```json
{
  "success": true,
  "data": true
}
```

### 2. –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**Request:**
```bash
GET /api/v3.0/auth/users?page=1&limit=10
Authorization: Bearer ADMIN_TOKEN
```

**Response:**
```json
{
  "success": true,
  "data": {
    "users": [
      {
        "id": 5,
        "email": "dean@fit.com",
        "fio": "–î–µ–∫–∞–Ω –§–Ü–¢",
        "specialty": "–Ü–¢",
        "role_name": "dean",
        "role_id": 3,
        "is_active": true,
        "faculty_id": "fit"
      }
    ],
    "pagination": {...}
  }
}
```

### 3. –õ–æ–≥—ñ–Ω –¥–µ–∫–∞–Ω–∞

**Request:**
```bash
POST /api/v3.0/auth/login

{
  "email": "dean@fit.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "tokens": {
      "access_token": "...",
      "refresh_token": "..."
    },
    "user": {
      "id": "5",
      "fio": "–î–µ–∫–∞–Ω –§–Ü–¢",
      "email": "dean@fit.com",
      "is_active": true,
      "specialty": "–Ü–¢",
      "role_name": "dean",
      "role_id": 3,
      "faculty_id": "fit"
    }
  }
}
```

### 4. –î–µ–∫–∞–Ω –æ—Ç—Ä–∏–º—É—î —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫

**Request:**
```bash
GET /api/v3.0/applicant/requests?page=1
Authorization: Bearer DEAN_TOKEN
```

**–ü–æ–≤–µ–¥—ñ–Ω–∫–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ñ—ñ–ª—å—Ç—Ä—É—î—Ç—å—Å—è –ø–æ faculty_id='fit'
- –ù–∞–≤—ñ—Ç—å —è–∫—â–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ ?faculty=fmf, –¥–µ–∫–∞–Ω –ø–æ–±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ FIT

---

## üß™ –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
- [ ] –í–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é: `mysql -u user_vstup -p db_vstup < migrations/001_add_faculty_id_to_users.sql`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É: `DESCRIBE users;`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏: `SHOW INDEX FROM users;`

### –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–µ–∫–∞–Ω—ñ–≤
- [ ] –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–µ–∫–∞–Ω–æ–º –∑ faculty_id
- [ ] –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–µ–∫–∞–Ω–∞ –±–µ–∑ faculty_id (–º–∞—î –±—É—Ç–∏ –ø–æ–º–∏–ª–∫–∞)
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ faculty_id –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –ë–î
- [ ] –ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–ª—å –∑ dean –Ω–∞ user (faculty_id –º–∞—î –æ—á–∏—Å—Ç–∏—Ç–∏—Å—å)

### –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞—è–≤–æ–∫
- [ ] –î–µ–∫–∞–Ω –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∑–∞—è–≤–∫–∏ —Å–≤–æ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
- [ ] –î–µ–∫–∞–Ω –ù–ï –±–∞—á–∏—Ç—å –∑–∞—è–≤–∫–∏ —ñ–Ω—à–∏—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—ñ–≤
- [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä ?faculty —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è –¥–ª—è –¥–µ–∫–∞–Ω—ñ–≤
- [ ] –ê–¥–º—ñ–Ω –±–∞—á–∏—Ç—å –≤—Å—ñ –∑–∞—è–≤–∫–∏

### –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É
- [ ] –î–µ–∫–∞–Ω –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –∑–∞—è–≤–∫–∏ (403 –¥–ª—è —á—É–∂–∏—Ö)
- [ ] –î–µ–∫–∞–Ω –º–æ–∂–µ –≤–∏–¥–∞–ª—è—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –∑–∞—è–≤–∫–∏ (403 –¥–ª—è —á—É–∂–∏—Ö)
- [ ] –î–µ–∫–∞–Ω –º–æ–∂–µ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ PDF —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å–≤–æ—ó—Ö –∑–∞—è–≤–æ–∫ (403 –¥–ª—è —á—É–∂–∏—Ö)
- [ ] –î–µ–∫–∞–Ω –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∑–∞—è–≤–∫–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å–≤–æ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É

---

## üì¶ –§–∞–π–ª–∏ –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

1. **SQL –º—ñ–≥—Ä–∞—Ü—ñ—è:**
   - `migrations/001_add_faculty_id_to_users.sql`

2. **–û–Ω–æ–≤–ª–µ–Ω—ñ PHP —Ñ–∞–π–ª–∏:**
   - `models/Auth.php`
   - `controllers/Auth.php`
   - `controllers/Applicant.php`

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
   - `DEPLOYMENT_GUIDE.md` - —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
   - `IMPLEMENTATION_SUMMARY.md` - —Ü–µ–π —Ñ–∞–π–ª

4. **–¢–∏–º—á–∞—Å–æ–≤—ñ —Ñ–∞–π–ª–∏ (–º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏):**
   - `check_db.php`
   - `check_db_simple.php`

---

## üöÄ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –ö—Ä–æ–∫ 1: Backup
```bash
mysqldump -u user_vstup -p db_vstup > backup_$(date +%Y%m%d_%H%M%S).sql
```

### –ö—Ä–æ–∫ 2: –ú—ñ–≥—Ä–∞—Ü—ñ—è –ë–î
```bash
mysql -u user_vstup -p db_vstup < migrations/001_add_faculty_id_to_users.sql
```

### –ö—Ä–æ–∫ 3: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É
```bash
git pull origin claude/implement-missing-apis-01TkSLwhSkzG3D7q3VSEPzZ6
```

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞
```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
DESCRIBE users;

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ –Ω–µ –ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ
SELECT COUNT(*) FROM users;
SELECT * FROM users WHERE role = 'admin' LIMIT 1;
```

### –ö—Ä–æ–∫ 5: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–µ–∫–∞–Ω–∞
- –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞—è–≤–∫–∏
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é

---

## ‚úÖ –ü—ñ–¥—Å—É–º–æ–∫

**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –î–û –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø ‚úÖ

**–©–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ü–æ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–æ–ª—ñ "–î–µ–∫–∞–Ω —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É"
- ‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω—ñ API endpoints
- ‚úÖ –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–ø–µ–∫–∏
- ‚úÖ –ó–≤–æ—Ä–æ—Ç–Ω—è —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞

**–ó–º—ñ–Ω–∏ –≤ —Ü–∏—Ñ—Ä–∞—Ö:**
- üìù –§–∞–π–ª—ñ–≤ –∑–º—ñ–Ω–µ–Ω–æ: 3
- üóÑÔ∏è –¢–∞–±–ª–∏—Ü—å –æ–Ω–æ–≤–ª–µ–Ω–æ: 1
- üîê –ù–æ–≤–∞ —Ä–æ–ª—å: 1
- üì° API endpoints –æ–Ω–æ–≤–ª–µ–Ω–æ: 8
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–æ–∫ –±–µ–∑–ø–µ–∫–∏ –¥–æ–¥–∞–Ω–æ: 12

**–ì–æ—Ç–æ–≤–æ –¥–æ:**
- ‚úÖ –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –Ω–∞ staging
- ‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ frontend
- ‚úÖ Production deployment (–ø—ñ—Å–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** 2025-11-29
**–ê–≤—Ç–æ—Ä:** Claude AI
**–í–µ—Ä—Å—ñ—è:** 1.0
